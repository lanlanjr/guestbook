{% extends "base.html" %}

{% block title %}Manage Content - {{ event.name }} - PortalShare{% endblock %}

{% block extra_css %}
<style>
    .theme-card {
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .theme-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .theme-card.border-primary {
        border-width: 2px !important;
        box-shadow: 0 0 15px rgba(13, 110, 253, 0.3);
    }
    
    .theme-preview {
        border: 1px solid #eee;
        position: relative;
        overflow: hidden;
    }
    
    .theme-card .form-check {
        margin-bottom: 0;
    }
    
    .theme-card .form-check-input {
        margin-top: 0.2rem;
    }
    
    .theme-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255,255,255,0.1);
        opacity: 0;
        transition: opacity 0.3s;
    }
    
    .theme-card:hover::after {
        opacity: 1;
    }
    
    .theme-card.border-primary::before {
        content: '\f00c';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        position: absolute;
        top: -10px;
        right: -10px;
        width: 30px;
        height: 30px;
        background: #0d6efd;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: scale(0);
        transition: transform 0.3s ease;
        z-index: 2;
    }
    
    .theme-card.border-primary::before {
        transform: scale(1);
    }
    
    /* Tab styles */
    .nav-tabs {
        border-bottom: 1px solid var(--primary-color, #ff6b6b);
    }
    
    .nav-tabs .nav-link {
        color: #333333;
        background-color: #777777;
        font-weight: 600;
        border: 1px solid transparent;
        border-top-left-radius: 0.5rem;
        border-top-right-radius: 0.5rem;
        transition: all 0.3s ease;
        margin-right: 5px;
        padding: 0.75rem 1.25rem;
    }
    
    .nav-tabs .nav-link i {
        color: #555555;
        margin-right: 0.5rem;
    }
    
    .nav-tabs .nav-link:hover {
        border-color: #e9ecef #e9ecef #dee2e6;
        color: #000000;
    }
    
    .nav-tabs .nav-link:hover i {
        color: #000000;
    }
    
    .nav-tabs .nav-link.active {
        color: var(--tab-active-color, var(--primary-color, #ff6b6b));
        background-color: #434242;
        border-color: var(--primary-color, #ff6b6b) var(--primary-color, #ff6b6b) #fff;
        border-top-width: 2px;
        border-left-width: 2px;
        border-right-width: 2px;
        font-weight: 700;
    }
    
    .nav-tabs .nav-link.active i {
        color: var(--tab-active-color, var(--primary-color, #ff6b6b));
    }
    
    .nav-tabs .nav-link .badge {
        transition: all 0.3s ease;
        background-color: var(--primary-color, #0d6efd) !important;
        color: white;
    }
    
    .nav-tabs .nav-link.active .badge {
        background-color: var(--tab-active-color, var(--primary-color, #ff6b6b)) !important;
    }
    
    /* Tab content transition */
    .tab-content > .tab-pane {
        transition: all 0.3s ease;
    }
    
    .tab-content > .active {
        animation: fadeIn 0.5s;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('view_event', event_uuid=event.uuid) }}">{{ event.name }}</a></li>
            <li class="breadcrumb-item active" aria-current="page">Manage Content</li>
        </ol>
    </nav>

    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="mb-3">Manage Content: {{ event.name }}</h1>
            <p class="text-muted">Review and manage all content uploaded to your event. You can delete any inappropriate content.</p>
        </div>
        <div class="col-md-4 text-md-end">
            <a href="{{ url_for('view_event', event_uuid=event.uuid) }}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left me-2"></i> Back to Event
            </a>
        </div>
    </div>

    <!-- Tabs for different content types -->
    <ul class="nav nav-tabs mb-4" id="contentTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="photos-tab" data-bs-toggle="tab" data-bs-target="#photos-content" type="button" role="tab" aria-controls="photos-content" aria-selected="true">
                <i class="fas fa-images fa-fw me-2"></i> Photos <span class="badge bg-primary rounded-pill ms-1">{{ photos|length }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="audio-tab" data-bs-toggle="tab" data-bs-target="#audio-content" type="button" role="tab" aria-controls="audio-content" aria-selected="false">
                <i class="fas fa-microphone-alt fa-fw me-2"></i> Audio Messages <span class="badge bg-primary rounded-pill ms-1">{{ audio_messages|length }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="messages-tab" data-bs-toggle="tab" data-bs-target="#messages-content" type="button" role="tab" aria-controls="messages-content" aria-selected="false">
                <i class="fas fa-book-open fa-fw me-2"></i> Guestbook Messages <span class="badge bg-primary rounded-pill ms-1">{{ guestbook_entries|length }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings-content" type="button" role="tab" aria-controls="settings-content" aria-selected="false">
                <i class="fas fa-sliders-h fa-fw me-2"></i> Feature Controls
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="event-details-tab" data-bs-toggle="tab" data-bs-target="#event-details-content" type="button" role="tab" aria-controls="event-details-content" aria-selected="false">
                <i class="fas fa-edit fa-fw me-2"></i> Event Details
            </button>
        </li>
    </ul>

    <!-- Tab content -->
    <div class="tab-content" id="contentTabsContent">
        <!-- Photos Tab -->
        <div class="tab-pane fade show active" id="photos-content" role="tabpanel" aria-labelledby="photos-tab">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">Photos</h3>
                    {% if photos %}
                    <form method="POST" action="{{ url_for('reset_photos', event_uuid=event.uuid) }}" onsubmit="return confirm('Are you sure you want to delete ALL photos? This action cannot be undone.');">
                        <button type="submit" class="btn btn-outline-danger">
                            <i class="fas fa-trash-alt me-2"></i> Reset All Photos
                        </button>
                    </form>
                    {% endif %}
                </div>
                <div class="card-body">
                    {% if photos %}
                        <div class="row">
                            {% for photo in photos %}
                                <div class="col-md-4 mb-4">
                                    <div class="card h-100">
                                        <img src="{{ url_for('uploaded_file', folder='photos', filename=photo.filename) }}" class="card-img-top" alt="Photo by {{ photo.guest_name }}" style="height: 200px; object-fit: cover;">
                                        <div class="card-body">
                                            <h5 class="card-title">{{ photo.guest_name or 'Anonymous' }}</h5>
                                            <p class="card-text text-muted small">{{ photo.created_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
                                            {% if photo.caption %}
                                                <p class="card-text">{{ photo.caption }}</p>
                                            {% endif %}
                                        </div>
                                        <div class="card-footer bg-white">
                                            <form method="POST" action="{{ url_for('delete_photo', event_uuid=event.uuid, photo_id=photo.id) }}" onsubmit="return confirm('Are you sure you want to delete this photo? This action cannot be undone.');">
                                                <button type="submit" class="btn btn-danger w-100">
                                                    <i class="fas fa-trash-alt me-2"></i> Delete Photo
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-camera display-4 text-muted mb-3"></i>
                            <p>No photos have been uploaded yet.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Audio Messages Tab -->
        <div class="tab-pane fade" id="audio-content" role="tabpanel" aria-labelledby="audio-tab">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">Audio Messages</h3>
                    {% if audio_messages %}
                    <form method="POST" action="{{ url_for('reset_audio', event_uuid=event.uuid) }}" onsubmit="return confirm('Are you sure you want to delete ALL audio messages? This action cannot be undone.');">
                        <button type="submit" class="btn btn-outline-danger">
                            <i class="fas fa-trash-alt me-2"></i> Reset All Audio
                        </button>
                    </form>
                    {% endif %}
                </div>
                <div class="card-body">
                    {% if audio_messages %}
                        <div class="row">
                            {% for message in audio_messages %}
                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title">{{ message.guest_name }}</h5>
                                            <p class="card-text text-muted small mb-2">{{ message.created_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
                                            <p class="card-text text-muted small mb-3">Duration: {{ message.duration }} seconds</p>
                                            <audio controls class="w-100 mb-3">
                                                <source src="{{ url_for('uploaded_file', folder='audio', filename=message.filename) }}" type="audio/mpeg">
                                                Your browser does not support the audio element.
                                            </audio>
                                            <form method="POST" action="{{ url_for('delete_audio', event_uuid=event.uuid, audio_id=message.id) }}" onsubmit="return confirm('Are you sure you want to delete this audio message? This action cannot be undone.');">
                                                <button type="submit" class="btn btn-danger w-100">
                                                    <i class="fas fa-trash-alt me-2"></i> Delete Audio Message
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-microphone display-4 text-muted mb-3"></i>
                            <p>No audio messages have been recorded yet.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Guestbook Messages Tab -->
        <div class="tab-pane fade" id="messages-content" role="tabpanel" aria-labelledby="messages-tab">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">Guestbook Messages</h3>
                    {% if guestbook_entries %}
                    <form method="POST" action="{{ url_for('reset_messages', event_uuid=event.uuid) }}" onsubmit="return confirm('Are you sure you want to delete ALL guestbook messages? This action cannot be undone.');">
                        <button type="submit" class="btn btn-outline-danger">
                            <i class="fas fa-trash-alt me-2"></i> Reset All Messages
                        </button>
                    </form>
                    {% endif %}
                </div>
                <div class="card-body">
                    {% if guestbook_entries %}
                        <div class="row">
                            {% for entry in guestbook_entries %}
                                <div class="col-md-6 mb-4">
                                    <div class="card message-card">
                                        <div class="card-body">
                                            <h5 class="card-title">{{ entry.name }}</h5>
                                            <p class="card-text text-muted small mb-2">{{ entry.created_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
                                            <p class="card-text mb-3">{{ entry.message }}</p>
                                            <form method="POST" action="{{ url_for('delete_message', event_uuid=event.uuid, message_id=entry.id) }}" onsubmit="return confirm('Are you sure you want to delete this message? This action cannot be undone.');">
                                                <button type="submit" class="btn btn-danger w-100">
                                                    <i class="fas fa-trash-alt me-2"></i> Delete Message
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-book-open display-4 text-muted mb-3"></i>
                            <p>No guestbook messages have been submitted yet.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Feature Controls Tab -->
        <div class="tab-pane fade" id="settings-content" role="tabpanel" aria-labelledby="settings-tab">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">Feature Controls</h3>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('update_event_settings', event_uuid=event.uuid) }}">
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card border-primary">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">Gallery Visibility</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" role="switch" id="galleryEnabled" name="gallery_enabled" {% if event.gallery_enabled %}checked{% endif %}>
                                            <label class="form-check-label" for="galleryEnabled">
                                                <span class="fw-bold">Enable Gallery</span>
                                                <span class="badge ms-2" id="galleryStatus">
                                                    <span class="{% if event.gallery_enabled %}text-success{% else %}text-danger{% endif %} fw-bold">
                                                        {% if event.gallery_enabled %}Enabled{% else %}Disabled{% endif %}
                                                    </span>
                                                </span>
                                            </label>
                                        </div>
                                        <p class="text-muted small">When disabled, guests won't be able to access the gallery view or slideshow.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <div class="card border-info">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="mb-0">Event Theme</h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted mb-3">Choose a theme that best fits your event style and mood.</p>
                                        <div class="row g-3">
                                            <div class="col-md-3 col-6">
                                                <div class="card theme-card h-100 {% if event.theme == 'default' or not event.theme %}border-primary{% endif %}" data-theme="default" onclick="selectTheme('default', this)">
                                                    <div class="card-body text-center p-3">
                                                        <div class="theme-preview mb-3" style="height: 100px; background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%); border-radius: 8px;"></div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio" name="theme" id="themeDefault" value="default" {% if event.theme == 'default' or not event.theme %}checked{% endif %}>
                                                            <label class="form-check-label" for="themeDefault">
                                                                Default
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3 col-6">
                                                <div class="card theme-card h-100 {% if event.theme == 'elegant' %}border-primary{% endif %}" data-theme="elegant" onclick="selectTheme('elegant', this)">
                                                    <div class="card-body text-center p-3">
                                                        <div class="theme-preview mb-3" style="height: 100px; background: linear-gradient(135deg, #2c3e50 0%, #bdc3c7 100%); border-radius: 8px;"></div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio" name="theme" id="themeElegant" value="elegant" {% if event.theme == 'elegant' %}checked{% endif %}>
                                                            <label class="form-check-label" for="themeElegant">
                                                                Elegant
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3 col-6">
                                                <div class="card theme-card h-100 {% if event.theme == 'romantic' %}border-primary{% endif %}" data-theme="romantic" onclick="selectTheme('romantic', this)">
                                                    <div class="card-body text-center p-3">
                                                        <div class="theme-preview mb-3" style="height: 100px; background: linear-gradient(135deg, #ff758c 0%, #ff7eb3 100%); border-radius: 8px;"></div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio" name="theme" id="themeRomantic" value="romantic" {% if event.theme == 'romantic' %}checked{% endif %}>
                                                            <label class="form-check-label" for="themeRomantic">
                                                                Romantic
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3 col-6">
                                                <div class="card theme-card h-100 {% if event.theme == 'nature' %}border-primary{% endif %}" data-theme="nature" onclick="selectTheme('nature', this)">
                                                    <div class="card-body text-center p-3">
                                                        <div class="theme-preview mb-3" style="height: 100px; background: linear-gradient(135deg, #76b852 0%, #8DC26F 100%); border-radius: 8px;"></div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio" name="theme" id="themeNature" value="nature" {% if event.theme == 'nature' %}checked{% endif %}>
                                                            <label class="form-check-label" for="themeNature">
                                                                Nature
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <h4 class="mb-3 border-bottom pb-2">Upload Controls</h4>
                                <p class="text-muted">Control which types of content guests can upload or submit to your event.</p>
                            </div>
                            <div class="col-md-4">
                                <div class="card h-100 {% if event.photo_upload_enabled %}border-success{% else %}border-danger{% endif %}">
                                    <div class="card-header {% if event.photo_upload_enabled %}bg-success{% else %}bg-danger{% endif %} text-white">
                                        <h5 class="mb-0 d-flex justify-content-between align-items-center">
                                            <span>Photo Uploads</span>
                                            <span class="badge bg-white text-{% if event.photo_upload_enabled %}success{% else %}danger{% endif %}">
                                                {% if event.photo_upload_enabled %}Enabled{% else %}Disabled{% endif %}
                                            </span>
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" role="switch" id="photoUploadEnabled" name="photo_upload_enabled" {% if event.photo_upload_enabled %}checked{% endif %}>
                                            <label class="form-check-label" for="photoUploadEnabled">Allow Photo Uploads</label>
                                        </div>
                                        <p class="text-muted small">Allow guests to upload photos to your event gallery.</p>
                                        <hr>
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" role="switch" id="compressImages" name="compress_images" {% if event.compress_images %}checked{% endif %}>
                                            <label class="form-check-label" for="compressImages">Compress Images</label>
                                        </div>
                                        <p class="text-muted small">Minimize image size to save storage and speed up uploads.</p>
                                        <hr>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" id="showPhotosInGallery" name="show_photos_in_gallery" {% if event.show_photos_in_gallery %}checked{% endif %}>
                                            <label class="form-check-label" for="showPhotosInGallery">Show in Gallery</label>
                                        </div>
                                        <p class="text-muted small">Display photos in the event gallery.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card h-100 {% if event.audio_upload_enabled %}border-success{% else %}border-danger{% endif %}">
                                    <div class="card-header {% if event.audio_upload_enabled %}bg-success{% else %}bg-danger{% endif %} text-white">
                                        <h5 class="mb-0 d-flex justify-content-between align-items-center">
                                            <span>Audio Messages</span>
                                            <span class="badge bg-white text-{% if event.audio_upload_enabled %}success{% else %}danger{% endif %}">
                                                {% if event.audio_upload_enabled %}Enabled{% else %}Disabled{% endif %}
                                            </span>
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" role="switch" id="audioUploadEnabled" name="audio_upload_enabled" {% if event.audio_upload_enabled %}checked{% endif %}>
                                            <label class="form-check-label" for="audioUploadEnabled">Allow Audio Messages</label>
                                        </div>
                                        <p class="text-muted small">Allow guests to record and share audio messages.</p>
                                        <hr>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" id="showAudioInGallery" name="show_audio_in_gallery" {% if event.show_audio_in_gallery %}checked{% endif %}>
                                            <label class="form-check-label" for="showAudioInGallery">Show in Gallery</label>
                                        </div>
                                        <p class="text-muted small">Display audio messages in the event gallery.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card h-100 {% if event.guestbook_enabled %}border-success{% else %}border-danger{% endif %}">
                                    <div class="card-header {% if event.guestbook_enabled %}bg-success{% else %}bg-danger{% endif %} text-white">
                                        <h5 class="mb-0 d-flex justify-content-between align-items-center">
                                            <span>Guestbook</span>
                                            <span class="badge bg-white text-{% if event.guestbook_enabled %}success{% else %}danger{% endif %}">
                                                {% if event.guestbook_enabled %}Enabled{% else %}Disabled{% endif %}
                                            </span>
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" role="switch" id="guestbookEnabled" name="guestbook_enabled" {% if event.guestbook_enabled %}checked{% endif %}>
                                            <label class="form-check-label" for="guestbookEnabled">Allow Guestbook Messages</label>
                                        </div>
                                        <p class="text-muted small">Allow guests to submit text messages to the guestbook.</p>
                                        <hr>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" id="showGuestbookInGallery" name="show_guestbook_in_gallery" {% if event.show_guestbook_in_gallery %}checked{% endif %}>
                                            <label class="form-check-label" for="showGuestbookInGallery">Show in Gallery</label>
                                        </div>
                                        <p class="text-muted small">Display guestbook messages in the event gallery.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 col-md-6 mx-auto">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save me-2"></i> Save Settings
                            </button>
                        </div>
                    </form>
                    
                    <div class="row mt-5">
                        <div class="col-md-12">
                            <div class="card border-danger">
                                <div class="card-header bg-danger text-white">
                                    <h5 class="mb-0">Reset All Content</h5>
                                </div>
                                <div class="card-body">
                                    <p class="text-danger"><strong>Warning:</strong> This action will permanently delete all photos, audio messages, and guestbook entries for this event.</p>
                                    <form method="POST" action="{{ url_for('reset_all_content', event_uuid=event.uuid) }}" onsubmit="return confirm('WARNING: This will delete ALL content (photos, audio messages, and guestbook entries) for this event. This action CANNOT be undone. Are you absolutely sure?');">
                                        <div class="d-grid">
                                            <button type="submit" class="btn btn-danger">
                                                <i class="fas fa-exclamation-triangle me-2"></i> Reset All Content
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Event Details Tab -->
        <div class="tab-pane fade" id="event-details-content" role="tabpanel" aria-labelledby="event-details-tab">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">Edit Event Details</h3>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('update_event_details', event_uuid=event.uuid) }}">
                        <div class="mb-4">
                            <label for="eventName" class="form-label">Event Name</label>
                            <input type="text" class="form-control" id="eventName" name="name" value="{{ event.name }}" required>
                        </div>
                        
                        <div class="mb-4">
                            <label for="eventDate" class="form-label">Event Date</label>
                            <input type="date" class="form-control" id="eventDate" name="date" value="{{ event.date.strftime('%Y-%m-%d') }}" min="{{ today_date }}" required>
                            <!-- <div class="form-text">You can only select today or future dates</div> -->
                        </div>
                        
                        <div class="mb-4">
                            <label for="eventLocation" class="form-label">Location</label>
                            <input type="text" class="form-control" id="eventLocation" name="location" value="{{ event.location or '' }}">
                            <div class="form-text">Where is your event taking place?</div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="eventDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="eventDescription" name="description" rows="5">{{ event.description or '' }}</textarea>
                            <div class="form-text">Provide details about your event</div>
                        </div>
                        
                        <div class="d-grid gap-2 col-md-6 mx-auto">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save me-2"></i> Update Event Details
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle direct links to tabs
        const hash = window.location.hash;
        if (hash) {
            const tab = document.querySelector(`[data-bs-target="${hash}"]`);
            if (tab) {
                const tabInstance = new bootstrap.Tab(tab);
                tabInstance.show();
            }
        }
        
        // Feature toggle real-time UI updates
        const toggles = {
            gallery: document.getElementById('galleryEnabled'),
            photo: document.getElementById('photoUploadEnabled'),
            audio: document.getElementById('audioUploadEnabled'),
            guestbook: document.getElementById('guestbookEnabled'),
            showPhotos: document.getElementById('showPhotosInGallery'),
            showAudio: document.getElementById('showAudioInGallery'),
            showGuestbook: document.getElementById('showGuestbookInGallery')
        };
        
        // Update UI based on toggle state
        function updateToggleUI(toggleElement, parentSelector, labelSelector) {
            const isEnabled = toggleElement.checked;
            const parent = toggleElement.closest(parentSelector);
            const statusBadge = parent.querySelector(labelSelector);
            
            if (parentSelector === '.card') {
                // For feature cards
                const header = parent.querySelector('.card-header');
                if (isEnabled) {
                    parent.classList.remove('border-danger');
                    parent.classList.add('border-success');
                    header.classList.remove('bg-danger');
                    header.classList.add('bg-success');
                    statusBadge.textContent = 'Enabled';
                    statusBadge.classList.remove('text-danger');
                    statusBadge.classList.add('text-success');
                } else {
                    parent.classList.remove('border-success');
                    parent.classList.add('border-danger');
                    header.classList.remove('bg-success');
                    header.classList.add('bg-danger');
                    statusBadge.textContent = 'Disabled';
                    statusBadge.classList.remove('text-success');
                    statusBadge.classList.add('text-danger');
                }
            } else {
                // For gallery toggle
                if (isEnabled) {
                    statusBadge.textContent = 'Enabled';
                    statusBadge.classList.remove('bg-danger');
                    statusBadge.classList.add('bg-success');
                } else {
                    statusBadge.textContent = 'Disabled';
                    statusBadge.classList.remove('bg-success');
                    statusBadge.classList.add('bg-danger');
                }
            }
        }
        
        // Add event listeners
        if (toggles.gallery) {
            toggles.gallery.addEventListener('change', function() {
                updateToggleUI(this, '.card', '.badge');
            });
        }
        
        if (toggles.photo) {
            toggles.photo.addEventListener('change', function() {
                updateToggleUI(this, '.card', '.badge');
            });
        }
        
        if (toggles.audio) {
            toggles.audio.addEventListener('change', function() {
                updateToggleUI(this, '.card', '.badge');
            });
        }
        
        if (toggles.guestbook) {
            toggles.guestbook.addEventListener('change', function() {
                updateToggleUI(this, '.card', '.badge');
            });
        }
        
        if (toggles.showPhotos) {
            toggles.showPhotos.addEventListener('change', function() {
                updateToggleUI(this, '.card', '.badge');
            });
        }
        
        if (toggles.showAudio) {
            toggles.showAudio.addEventListener('change', function() {
                updateToggleUI(this, '.card', '.badge');
            });
        }
        
        if (toggles.showGuestbook) {
            toggles.showGuestbook.addEventListener('change', function() {
                updateToggleUI(this, '.card', '.badge');
            });
        }
        
        // Theme selection handling
        const themeCards = document.querySelectorAll('.theme-card');
        const themeRadios = document.querySelectorAll('input[name="theme"]');
        
        themeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                // Reset all theme cards
                themeCards.forEach(card => {
                    card.classList.remove('border-primary');
                });
                
                // Highlight selected theme card
                if (this.checked) {
                    this.closest('.theme-card').classList.add('border-primary');
                }
            });
        });
        
        // Handle date validation for events with past dates
        const eventDateField = document.getElementById('eventDate');
        if (eventDateField) {
            const currentValue = eventDateField.value;
            const minValue = eventDateField.min;
            
            // Check if the current date is before the minimum allowed date
            if (currentValue < minValue) {
                // Create warning message
                const warningDiv = document.createElement('div');
                warningDiv.className = 'alert alert-warning mt-2';
                warningDiv.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i> This event is set to a past date. You can keep this date for historical events, but any updates will require selecting a future date.';
                
                // Insert warning after the date field
                eventDateField.parentNode.insertBefore(warningDiv, eventDateField.nextSibling);
                
                // Special handling for form submission
                const eventForm = eventDateField.closest('form');
                eventForm.addEventListener('submit', function(e) {
                    // If date wasn't changed and is in the past, allow submission
                    if (eventDateField.value === currentValue) {
                        // Remove min attribute temporarily to allow submission with past date
                        eventDateField.removeAttribute('min');
                    }
                });
            }
        }
    });
    
    // Function to select a theme and update the preview
    function selectTheme(theme, element) {
        // Update radio button
        document.getElementById('theme' + theme.charAt(0).toUpperCase() + theme.slice(1)).checked = true;
        
        // Reset all theme cards
        document.querySelectorAll('.theme-card').forEach(card => {
            card.classList.remove('border-primary');
        });
        
        // Highlight selected theme card
        element.classList.add('border-primary');
        
        // Show live preview by temporarily adding the theme class to body
        document.body.className = '';
        document.body.classList.add('theme-' + theme);
        
        // Add a preview message
        showPreviewMessage(theme);
    }
    
    // Function to show a preview message
    function showPreviewMessage(theme) {
        // Remove any existing preview message
        const existingMessage = document.getElementById('themePreviewMessage');
        if (existingMessage) {
            existingMessage.remove();
        }
        
        // Create preview message
        const message = document.createElement('div');
        message.id = 'themePreviewMessage';
        message.className = 'alert alert-info alert-dismissible fade show mt-3';
        message.innerHTML = `
            <i class="fas fa-eye me-2"></i>
            <strong>Preview Mode:</strong> You're previewing the "${theme.charAt(0).toUpperCase() + theme.slice(1)}" theme. 
            <button type="submit" class="btn btn-sm btn-primary ms-2">Save Theme</button>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" onclick="resetPreview()"></button>
        `;
        
        // Insert message after the theme selection section
        const themeSection = document.querySelector('.theme-card').closest('.row').parentNode;
        themeSection.appendChild(message);
    }
    
    // Function to reset preview
    function resetPreview() {
        // Reset body class to the current theme
        const currentTheme = '{{ event.theme }}' || 'default';
        document.body.className = '';
        document.body.classList.add('theme-' + currentTheme);
    }
</script>
{% endblock %} 